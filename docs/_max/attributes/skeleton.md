---
products:
  - dp.kinect1
  - dp.kinect2
  - dp.kinect3
  - dp.oak
categories:
  - visual
usage:
  signature: "{0 | 1 | 2}"
  default: "off"
  examples:
    - "@skeleton 1"
---
Skeleton, joint, and user tracking output on the fifth outlet.
Output format (native Max messages, OSC protocol, etc.) is determined by
[`@skeletonformat`](skeletonformat.md).

* 0 = off
* 1 = joints
* 2 = joints + orientation

> :memo: Some sensors may not support orientation output

## User Identification

User identification messages are generated by enabling `@skeleton`.  The data provided is an
integer "playerID" which is a unique identifier representing the currently tracked/lost person.
This ID is unique within a given point of time and for a person seen by the sensor. Its
minimum value is `1` and often `6` is the most people the sensor can detect. Keep in mind that
some sensors support detecting than six people. This same playerID is used for
matching/connecting with other sensor data like the person's location, joints,
depthmap pixels, and sound location/association.

The three messages output are

```sh
OSC                        Max route                
-------------------------------------------------
/new_user playerID         new_user playerID
/lost_user playerID        lost_user playerID
/calib_success playerID    calib_success playerID

# Examples

/new_user 2                new_user 2
/calib_success 2           calib_success 2
/lost_user 2               lost_user 2
```

`new_user` Indicates a new person has been identified but full skeleton tracking is not yet available.
This is the first message in the possible progression of events for a given playerId.

`calib_success` Indicates the person's skeleton joints are now being fully tracked. This can only be
received after a `new_user` message.

`lost_user` Indicates the previously identified/tracked person has been lost. This can only be received
after a `new_user` message. It is possible to receive this event and _not_ have received a `calib_success`
message. This would indicate that a person was seen but the sensor was not able to fully track them before
they were lost. This lack of full skeletal tracking could be because of interference or because the sensor
was already skeletal tracking its maximum number of people. After receiving this message, the playerId may
be reused by the sensor for a new person.

If you are migrating from jit.openni, the additional messages calib_pose, calib_start, calib_fail,
exit_user, and reenter_user are not supported.

## User Location

User location messages, also known as center of mass, are generated when `@skeleton` is enabled.
Once a person is identified, you will begin receiving user location messages. It is not necessary
to have full skeletal tracking as indicated by a `calib_success` message. This enables you to
roughly track a person's location when there is interference or because the sensor was already
skeletal tracking its maximum number of people.

```sh
OSC                                       Max route
-----------------------------------------------------------------------------
/user/playerID x y z q                    user playerID x y z q

# Example
/user/2 42.1323 -100.8237 1984.348 0      user 2 42.1323 -100.8237 1984.348 0
```

* `userid` is an long integer and is the same unique playerID from the matching user identification message
* `x, y, z` are floating point numbers representing the real-world location of the person's center of mass
  relative to the sensor sensor. Their values are influenced by the attributes
  [`@distmeter`](distmeter.md), [`@flipx`](flipx.md), [`@rotatemethod`](rotatemethod.md), and
  [`@translate`](translate.md).
* `q` is an integer bit field that indicates the quality of the person's location. It is possible to
  have no, one, or multiple quality bit flags at the same time. The bit flags are summed together.
  Quality bit flag values are:  
  1 = Part of the player's body is out of frame to the camera's right.  
  2 = Part of the player's body is out of frame to the camera's left.  
  4 = Part of the player's body is out of frame above the camera's field of view.  
  8 = Part of the player's body is out of frame below the camera's field of view.  
  _Example:_ quality = 5 indicates the player's body is out of frame to the camera's right (1) and above (4). 1 + 4 = 5.
  > :memo: Some sensors may not support user quality output

## Skeleton Joints

Skeleton joint data is output when `@skeleton`, [`@skeldepth`](skeldepth.md), or [`@skelcolor`](skelcolor.md) are enabled.
This data is affected by the other attributes [`@distmeter`](distmeter.md), [`@flipx`](flipx.md), [`@align`](align.md),
[`@position`](position.md), [`@quat`](quat.md), [`@rotate`](rotate.md), [`@rotatexyz`](rotatexyz.md), and [`@scale`](scale.md).

> :memo: Microsoft Kinect joint positions are available at
> <https://docs.microsoft.com/en-us/previous-versions/windows/kinect/dn799273(v=ieb.10)> and
> <https://docs.microsoft.com/en-us/previous-versions/windows/kinect-1.8/jj131025(v=ieb.10)#skeleton-position-and-tracking-state>.
> The Kinect v1 documentation is better than Kinect v2. Also note, Microsoft Kinect sensor behavior for skeleton joint tracking
> will select the six most engaged users in the field of view. This behavior is consistent (not random), yet at the same time
> not driven by specific criteria. You can not manually select users for skeletal tracking.

### Real-world Skeleton-space Joints

Real-world skeleton joint locations in meters [`@distmeter 1`](distmeter.md) or millimeters [`@distmeter 0`](distmeter.md).

```sh
# OSC:                             @skeleton 1
/skel/userid/jointname x y z confidence

# OSC + orientation:               @skeleton 2
/skel/userid/jointname x y z confidence qx qy qz qw

# Max native:                      @skeleton 1 @skeletonformat 1
skel userid jointname x y z confidence

# Max native + orientation:        @skeleton 2 @skeletonformat 1
skel userid jointname x y z confidence qx qy qz qw
```

* `userid` is an integer which represents a user id, the same user/player id as described in previous sections
* `jointname` is one of the strings listed below; these are the same joint names as used by jit.openni
* `x, y, z` are floating point numbers and their values are affected by [`@distmeter`](distmeter.md),
  [`@flipx`](flipx.md), [`@align`](align.md), [`@position`](position.md), [`@quat`](quat.md),
  [`@rotate`](rotate.md), [`@rotatexyz`](rotatexyz.md), and [`@scale`](scale.md)
* `confidence` is a floating point number representing the sensor's confidence in the data values.
  The confidence value is [0.0 - 1.0] with 1.0 indicating the highest confidence. This confidence can be
  used to filter data by your patch or automatically with [@posconfidence](posconfidence.md).

Supported `jointname` for all output formats are:

    head        neck     torso    waist
    l_shoulder  l_elbow  l_wrist  l_hand
    r_shoulder  r_elbow  r_wrist  r_hand
    l_hip       l_knee   l_ankle  l_foot
    r_hip       r_knee   r_ankle  r_foot

Examples

```sh
# OSC:                            @skeleton 1 @distmeter 1
/skel/2/r_shoulder -1.204 2.053 3.712 0.5

# OSC + orientation:              @skeleton 2 @distmeter 1
/skel/2/r_shoulder -1.204 2.053 3.712 0.5 0.586775 0.469815 0.567755 -0.335593

# Max native:                     @skeleton 1 @distmeter 1 @skeletonformat 1
skel 2 r_shoulder -1.204 2.053 3.712 0.5

# Max native + orientation:       @skeleton 2 @distmeter 1 @skeletonformat 1
skel 2 r_shoulder -1.204 2.053 3.712 0.5 0.586775 0.469815 0.567755 -0.335593
```

### Skeleton Joint Orientation

The orientation of real-world coordinates can be optionally enabled with `@skeleton 2`. It is output
in your choice of four formats using [`@orientformat`](orientformat.md).

```sh
# Max native + quaternion orientation: @skeleton 2 @skeletonformat 1 @orientformat 0
skel userid jointname x y z confidence qx qy qz qw

# Max native + quaternion orientation: @skeleton 2 @skeletonformat 1 @orientformat 2
skel userid jointname x y z confidence m11 m12 m13 m14 m21 m22 m23 m24 m31 m32 m33 m34 m41 m42 m43 m44
```

This orientation data is output in your choice of a quaternion (4 floats) or 4x4 rotation matrix (16 floats).
If you were to look at the 3x3 rotation matrix within the 4x4, the first three are the direction of the
joint's +X axis given as a 3-vector in the chosen coordinate space, the second three are the +Y axis
direction, and the third three are the +Z axis direction.

The coordinate space for this orientation data is in your choice of *absolute* world coordinate space or
in a *hierarchical* rotation coordinate space. Details on the orientation data can be found at
<https://docs.microsoft.com/en-us/previous-versions/windows/kinect/dn799273(v=ieb.10)#joint-normals> and
<https://docs.microsoft.com/en-us/previous-versions/windows/kinect-1.8/hh973073(v=ieb.10)>.

> :memo: When migrating from jit.openni, the orientation data has changed. The rotations are *not*
> relative to a T-pose. This change must be managed by your Max patch.
